package spos;

import java.util.concurrent.Semaphore;

class SharedBuffer {
	int item;
	boolean available = false;
	
	Semaphore mutex = new Semaphore(1);
	Semaphore empty = new Semaphore(1);
	Semaphore full = new Semaphore(0);
	
	void produce(int value) {
		try {
			empty.acquire();
			mutex.acquire();
			
			item = value;
			System.out.println("Producer produced: " + item);
			available = true;
			
			mutex.release();
			full.release();
		}catch(InterruptedException e) {
			e.printStackTrace();
		}
	}
	
	void consume() {
		try {
			full.acquire();
			mutex.acquire();
			
			System.out.println("Consumer consumed: " + item);
			available = false;
			
			mutex.release();
			empty.release();
		}catch (InterruptedException e) {
			e.printStackTrace();
		}
	}
}


class Producer extends Thread{
	SharedBuffer buffer;
	
	Producer(SharedBuffer b){
		buffer = b;
	}
	
	public void run() {
		for(int i = 1; i <= 5; i++) {
			buffer.produce(i);
			try {Thread.sleep(500); } catch(InterruptedException e) {}
		}
	}
}

class Consumer extends Thread{
	SharedBuffer buffer;
	
	Consumer(SharedBuffer b){
		buffer = b;
	}
	
	public void run() {
		for(int i = 0; i<=5; i++) {
			buffer.consume();
			try {Thread.sleep(500); } catch(InterruptedException e) {}
		}
	}
}



public class ProducerConsumer {

	public static void main(String [] args) {
		SharedBuffer buffer = new SharedBuffer();
		Producer p = new Producer(buffer);
		Consumer c = new Consumer(buffer);
		
		p.start();
		c.start();
	}
	
	
	
	
	
	
	
	
	
	
	
	
	
}
